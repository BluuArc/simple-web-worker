"use strict";function postAll(){var r=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!Array.isArray(n))return returnNull(notArray(n));var e=isArrayOf("arrays")(n),t=isArrayOf("objects")(n),o=isArrayOf("strings")(n);return e||t||o?0===n.length?Promise.all(this.actions.map(function(n){var e=n.message;return r.postMessage(e)})):o?Promise.all(n.map(function(n){return r.postMessage(n)})):t?invalidObjectsArray(n)(["message","args"])?returnNull(wrongObjects(n)):Promise.all(n.map(function(n){var e=n.message,t=n.args;return r.postMessage(e,t)})):e?n.length!==this.actions.length?returnNull(wrongLength(n.length)(this.actions.length)):Promise.all(n.map(function(n,e){return r.postMessage(r.actions[e].message,n)})):void 0:returnNull(notArray(n))}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},isArrayOf=function(r){return function(n){var e=null;return"arrays"===r&&(e=function(r){return Array.isArray(r)}),"objects"===r&&(e=function(r){return"object"===(void 0===r?"undefined":_typeof(r))&&!Array.isArray(r)}),"strings"===r&&(e=function(r){return"string"==typeof r}),!!e&&n.every(e)}},notValid=function(r){return console.error(r),!1},invalidActions=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(Array.isArray(r)){if("objectsArray"===n||"actionsArray"===n)return r.some(function(r){return"object"!==(void 0===r?"undefined":_typeof(r))||Array.isArray(r)||null===r});if("stringsArray"===n)return r.some(function(r){return"string"!=typeof r})}return!1}},isValidArg=function r(n){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return"null"===e?null===n:"undefined"===e?void 0===n:Array.isArray(e)?e.some(function(e){return r(n)(e)}):!(!n||wrongType(n,e)||invalidActions(n)(e))}},wrongType=function r(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Array.isArray(e)?e.every(function(e){return r(n,e)}):Array.isArray(n)?"actionsArray"===e?invalidObjectsArray(n)(["message","func"]):"objectsArray"!==e&&"stringsArray"!==e&&"array"!==e:(void 0===n?"undefined":_typeof(n))!==e.toString()},invalidObjectsArray=function(r){return function(n){return r.some(function(r){return!n.every(function(n){return r.hasOwnProperty(n)})})}},isValidArgument=function(r){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return Array.isArray(n)?!!n.some(function(n){return isValidArg(r)(n)})||notValid(e):!(!r||wrongType(r,n)||invalidActions(r)(n))||notValid(e)}}},argumentError=function(r){var n=r.expected,e=void 0===n?"":n,t=r.received,o=r.extraInfo,i=void 0===o?"":o;try{return new TypeError("You should provide "+e+"\n"+i+"\nReceived: "+JSON.stringify(t))}catch(r){return"Converting circular structure to JSON"===r.message?new TypeError("You should provide "+e+"\n"+i+"\nReceived a circular structure: "+t):(console.error(r),new TypeError("You should provide something else..."))}},filterActions=function(r,n){return r.filter(function(r){var e=r.message;return JSON.stringify(e)===JSON.stringify(n)}).map(function(r){return r.func}).pop()},removeFrom=function(r){return function(n){var e=r.findIndex(function(r){return r.message===n});return-1===e?(console.warn("WARN! Impossible to unregister "+n+".\n"+n+" is not a registered action for this worker."),[]):r.splice(e,1)}},makeResponse=function(r){return"\n  self.onmessage = event => {\n    const args = event.data.message.args\n    if (args) {\n      self.postMessage(("+r+").apply(null, args))\n      return close()\n    }\n    self.postMessage(("+r+")())\n    return close()\n  }\n"},pushInto=function(r){return function(n){return r.push(n)}},notArray=function(r){return argumentError(notArrayOptions(r))},notArrayOptions=function(r){return{expected:"an array of strings, an array of objects, an array of arrays or no arguments",received:r}},wrongLength=function(r){return function(n){return argumentError(wrongLengthOptions(r)(n))}},wrongLengthOptions=function(r){return function(n){return{received:r,expected:"the same number of [args] as the number of registered actions on the worker",extraInfo:"This worker has "+n+" actions registered"}}},wrongObjects=function(r){return argumentError(wrongObjectsOptions(r))},wrongObjectsOptions=function(r){return{expected:r,extraInfo:"Every object of the array must contain the following fields:\n* message\n* args"}},returnNull=function(r){return console.error(r),null},createDisposableWorker=function(r){var n=window.URL||window.webkitURL,e=new Blob([r],{type:"application/javascript"}),t=new Worker(n.createObjectURL(e));return t.post=function(r){return new Promise(function(n,e){t.onmessage=function(r){return n(r.data)},t.onerror=function(r){console.error("Error: Line "+r.lineno+" in "+r.filename+": "+r.message),e(r)},t.postMessage({message:r})})},t},run=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments[1];if(!isValidArgument(r)("function")(argumentError({expected:"a function",received:r})))return null;if(!isValidArgument(n)(["array","undefined"])(argumentError({expected:"an array",received:n})))return null;var e=makeResponse(r);return createDisposableWorker(e).post({args:n})},post=function(r){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments[1],t=isValidArgument(n)("string")(argumentError({expected:"a string",received:n})),o=isValidArgument(e)(["array","undefined"])(argumentError({expected:"an array",received:e}));if(t&&o){var i=filterActions(r,n);return i?e?run(i,e):run(i):(i=function(r){return console.warn("WARN! "+r+" is not a registered action for this worker"),r+" is not a registered action for this worker"},e=JSON.stringify(n),run(i,[e]))}return null}},register=function(r){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e={expected:"an array of actions or an action",received:n,extraInfo:"Every action should be an object containing two fields:\n* message\n* func"};return isValidArgument(n)(["object","objectsArray"])(argumentError(e))?Array.isArray(n)?(n.forEach(pushInto(r)),r.length):pushInto(r)(n):null}},unregister=function(r){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e={expected:"an array of strings or a string",received:n};if(isValidArgument(n)(["string","stringsArray"])(argumentError(e))){var t=removeFrom(r);if(Array.isArray(n)){var o=n.reduce(function(r,n){return r=r.concat(t(n))},[]);return 0===o.length?(console.warn("WARN! Impossible to unregister "+JSON.stringify(n)+".\nNone of the actions is a registered action for this worker."),null):o}return t(n)}return null}},options=function(r){return{expected:"an array of objects",received:r,extraInfo:"Every action should be an object containing two fields:\n* message\n* func"}},create=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return isValidArgument(r)("actionsArray")(argumentError(options(r)))?{actions:r,postMessage:post(r),postAll:postAll,register:register(r),unregister:unregister(r)}:null},createWrapper=function(){return window.Worker?window.URL.createObjectURL||window.webkitURL.createObjectURL?{create:create,run:run}:(console.error("This browser does not have URL.createObjectURL method."),null):(console.error("This browser does not support Workers."),null)},WorkerWrapper=createWrapper();module.exports=WorkerWrapper;
//# sourceMappingURL=sww.min.js.map
